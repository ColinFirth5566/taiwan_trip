<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ—ºï¸ å°ç£å˜‰ç¾©å°å—æ—…éŠè·¯ç·š</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- Leaflet CSS and JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        #map {
            width: 100%;
            height: 500px;
            border-radius: 1rem;
            z-index: 1;
        }
        #canvas3d {
            width: 100%;
            height: 500px;
            border-radius: 1rem;
            background: linear-gradient(to bottom, #1e3a8a, #3b82f6);
        }
        .location-card {
            transition: all 0.3s ease;
        }
        .location-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }
        .leaflet-popup-content {
            font-family: system-ui, -apple-system, sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
    <div id="root"></div>

    <script>
        // Trip routes data with real coordinates
        const ROUTES = {
            route2: {
                name: 'è·¯ç·šäºŒï¼šå˜‰ç¾©æ–‡åŒ–ä¹‹æ—…',
                color: '#10b981',
                locations: [
                    {
                        name: 'æ•…å®®å—é™¢',
                        description: 'åœ‹ç«‹æ•…å®®åšç‰©é™¢å—éƒ¨é™¢å€ï¼Œäºæ´²è—è¡“æ–‡åŒ–åšç‰©é¤¨',
                        lat: 23.4694,
                        lng: 120.3394,
                        icon: 'ğŸ›ï¸',
                        time: '09:00-11:00'
                    },
                    {
                        name: 'å¸ƒè¢‹æ¼æ¸¯',
                        description: 'æ–°é®®æµ·ç”¢ã€è§€å…‰æ¼æ¸¯ã€æµ·é®®å¸‚å ´',
                        lat: 23.3778,
                        lng: 120.1647,
                        icon: 'âš“',
                        time: '11:30-12:30'
                    },
                    {
                        name: 'è‹±ç¾©å¤§åˆ©ç”Ÿéºµ',
                        description: 'å¸ƒè¢‹åœ¨åœ°ç¾é£Ÿï¼Œç¾©å¼æ–™ç†',
                        lat: 23.3765,
                        lng: 120.1655,
                        icon: 'ğŸ',
                        time: '12:30-13:30'
                    },
                    {
                        name: 'é«˜è·Ÿé‹æ•™å ‚',
                        description: 'æµªæ¼«è—è¡“è£ç½®ï¼ŒIGæ‰“å¡ç†±é»',
                        lat: 23.3625,
                        lng: 120.1394,
                        icon: 'ğŸ‘ ',
                        time: '14:00-15:00'
                    },
                    {
                        name: 'æ–°æ¸¯é¦™è—æ–‡åŒ–åœ’å€',
                        description: 'é¦™è—æ–‡åŒ–ã€æ‰‹ä½œé«”é©—',
                        lat: 23.5547,
                        lng: 120.3478,
                        icon: 'ğŸ•¯ï¸',
                        time: '15:30-16:30'
                    },
                    {
                        name: 'æ–°æ¸¯è€è¡—',
                        description: 'å‚³çµ±è€è¡—ã€åœ¨åœ°å°åƒã€æ–‡åŒ–å·¡ç¦®',
                        lat: 23.5569,
                        lng: 120.3456,
                        icon: 'ğŸ®',
                        time: '17:00-18:30'
                    }
                ]
            },
            day1: {
                name: 'ç¬¬ä¸€å¤©ï¼šå°å—ç¾é£Ÿä¹‹æ—…',
                color: '#f59e0b',
                locations: [
                    {
                        name: 'å—é¯¤é¯“ä»£å¤©å®®',
                        description: 'å°ç£ç‹çˆºç¸½å»Ÿï¼Œåœ‹å®šå¤è¹Ÿ',
                        lat: 23.2861,
                        lng: 120.0758,
                        icon: 'â›©ï¸',
                        time: '09:00-11:00'
                    },
                    {
                        name: 'é˜¿æ¨‚æ´»æµ·é®®',
                        description: 'æ–°é®®æµ·ç”¢æ–™ç†ï¼Œåœ¨åœ°æ¨è–¦',
                        lat: 23.1408,
                        lng: 120.1472,
                        icon: 'ğŸ¦',
                        time: '12:00-13:30'
                    },
                    {
                        name: 'é£¯åº— Check-in',
                        description: 'ä¼‘æ¯æ”¾é¬†æ™‚å…‰',
                        lat: 22.9908,
                        lng: 120.2133,
                        icon: 'ğŸ¨',
                        time: '14:00-17:00'
                    },
                    {
                        name: 'åœ‹è¯è¡—å¤œå¸‚',
                        description: 'å°å—å¿…é€›å¤œå¸‚ï¼Œç¾é£Ÿå¤©å ‚',
                        lat: 22.9974,
                        lng: 120.1973,
                        icon: 'ğŸŒƒ',
                        time: '18:00-21:00'
                    }
                ]
            }
        };

        // Three.js 3D Path Visualization
        class Path3D {
            constructor(containerId) {
                this.containerId = containerId;
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.locationMarkers = [];
                this.pathLines = [];
                this.animationId = null;
            }

            initialize() {
                const container = document.getElementById(this.containerId);
                if (!container) {
                    console.error('Container not found:', this.containerId);
                    return false;
                }

                // Scene
                this.scene = new THREE.Scene();
                this.scene.fog = new THREE.Fog(0x1e3a8a, 10, 50);

                // Camera
                this.camera = new THREE.PerspectiveCamera(
                    60,
                    container.clientWidth / container.clientHeight,
                    0.1,
                    1000
                );
                this.camera.position.set(0, 8, 20);
                this.camera.lookAt(0, 0, 0);

                // Renderer
                this.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                this.renderer.setSize(container.clientWidth, container.clientHeight);
                this.renderer.setClearColor(0x1e3a8a, 1);
                container.innerHTML = '';
                container.appendChild(this.renderer.domElement);

                // Lighting
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                this.scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 10, 5);
                this.scene.add(directionalLight);

                const pointLight = new THREE.PointLight(0xffffff, 0.5);
                pointLight.position.set(0, 10, 0);
                this.scene.add(pointLight);

                // Handle resize
                window.addEventListener('resize', () => {
                    if (!this.camera || !this.renderer) return;
                    const container = document.getElementById(this.containerId);
                    if (!container) return;
                    this.camera.aspect = container.clientWidth / container.clientHeight;
                    this.camera.updateProjectionMatrix();
                    this.renderer.setSize(container.clientWidth, container.clientHeight);
                });

                console.log('3D Scene initialized successfully');
                return true;
            }

            clearScene() {
                this.locationMarkers.forEach(marker => this.scene.remove(marker));
                this.pathLines.forEach(line => this.scene.remove(line));
                this.locationMarkers = [];
                this.pathLines = [];
            }

            createPath(locations, colorHex) {
                if (!this.scene) {
                    console.error('Scene not initialized');
                    return;
                }

                this.clearScene();
                console.log('Creating 3D path with', locations.length, 'locations');

                const color = new THREE.Color(colorHex);

                // Create location markers in a circle
                const numLocations = locations.length;
                const radius = 8;

                locations.forEach((loc, index) => {
                    // Main sphere
                    const geometry = new THREE.SphereGeometry(0.6, 32, 32);
                    const material = new THREE.MeshPhongMaterial({
                        color: color,
                        emissive: color,
                        emissiveIntensity: 0.4,
                        shininess: 100
                    });
                    const sphere = new THREE.Mesh(geometry, material);

                    // Position in circle with varying heights
                    const angle = (index / numLocations) * Math.PI * 2;
                    sphere.position.x = Math.cos(angle) * radius;
                    sphere.position.z = Math.sin(angle) * radius;
                    sphere.position.y = Math.sin(index * 0.8) * 2;

                    sphere.userData = { index, name: loc.name, baseY: sphere.position.y };
                    this.locationMarkers.push(sphere);
                    this.scene.add(sphere);

                    // Glow effect
                    const glowGeometry = new THREE.SphereGeometry(0.8, 32, 32);
                    const glowMaterial = new THREE.MeshBasicMaterial({
                        color: color,
                        transparent: true,
                        opacity: 0.3
                    });
                    const glow = new THREE.Mesh(glowGeometry, glowMaterial);
                    sphere.add(glow);

                    // Number label (ring)
                    const ringGeometry = new THREE.RingGeometry(0.7, 0.9, 32);
                    const ringMaterial = new THREE.MeshBasicMaterial({
                        color: 0xffffff,
                        side: THREE.DoubleSide,
                        transparent: true,
                        opacity: 0.8
                    });
                    const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                    ring.position.y = 1.2;
                    ring.rotation.x = -Math.PI / 2;
                    sphere.add(ring);
                });

                // Create path tubes connecting locations
                for (let i = 0; i < this.locationMarkers.length - 1; i++) {
                    const start = this.locationMarkers[i].position;
                    const end = this.locationMarkers[i + 1].position;

                    // Create curve with control points
                    const points = [];
                    const segments = 20;

                    for (let j = 0; j <= segments; j++) {
                        const t = j / segments;
                        const x = start.x + (end.x - start.x) * t;
                        const z = start.z + (end.z - start.z) * t;
                        const y = start.y + (end.y - start.y) * t + Math.sin(t * Math.PI) * 1.5;
                        points.push(new THREE.Vector3(x, y, z));
                    }

                    const curve = new THREE.CatmullRomCurve3(points);
                    const tubeGeometry = new THREE.TubeGeometry(curve, 64, 0.15, 8, false);
                    const tubeMaterial = new THREE.MeshPhongMaterial({
                        color: color,
                        transparent: true,
                        opacity: 0.8,
                        shininess: 80
                    });
                    const tube = new THREE.Mesh(tubeGeometry, tubeMaterial);
                    this.pathLines.push(tube);
                    this.scene.add(tube);
                }

                console.log('3D path created successfully');
            }

            animate() {
                if (!this.renderer || !this.scene || !this.camera) return;

                this.animationId = requestAnimationFrame(() => this.animate());

                // Rotate scene
                this.scene.rotation.y += 0.003;

                // Animate markers
                const time = Date.now() * 0.001;
                this.locationMarkers.forEach((marker, index) => {
                    marker.rotation.y += 0.02;
                    marker.position.y = marker.userData.baseY + Math.sin(time + index) * 0.2;

                    // Pulse glow
                    if (marker.children[0]) {
                        const scale = 1 + Math.sin(time * 2 + index) * 0.1;
                        marker.children[0].scale.set(scale, scale, scale);
                    }
                });

                this.renderer.render(this.scene, this.camera);
            }

            start() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
                this.animate();
            }

            stop() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                    this.animationId = null;
                }
            }
        }

        // Leaflet Map Integration
        class TripMap {
            constructor() {
                this.map = null;
                this.markers = [];
                this.polyline = null;
            }

            initialize(containerId, center) {
                const container = document.getElementById(containerId);
                if (!container) {
                    console.error('Map container not found');
                    return false;
                }

                // Initialize Leaflet map
                this.map = L.map(containerId).setView([center.lat, center.lng], 10);

                // Add OpenStreetMap tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'Â© OpenStreetMap contributors',
                    maxZoom: 19
                }).addTo(this.map);

                console.log('Map initialized successfully');
                return true;
            }

            clearMap() {
                this.markers.forEach(marker => this.map.removeLayer(marker));
                this.markers = [];
                if (this.polyline) {
                    this.map.removeLayer(this.polyline);
                    this.polyline = null;
                }
            }

            showRoute(locations, colorHex) {
                if (!this.map) return;

                this.clearMap();
                console.log('Showing route with', locations.length, 'locations');

                const latlngs = [];

                // Add markers
                locations.forEach((loc, index) => {
                    const customIcon = L.divIcon({
                        className: 'custom-marker',
                        html: `
                            <div style="
                                background: ${colorHex};
                                width: 40px;
                                height: 40px;
                                border-radius: 50%;
                                border: 4px solid white;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-weight: bold;
                                color: white;
                                font-size: 18px;
                                box-shadow: 0 4px 6px rgba(0,0,0,0.3);
                            ">${index + 1}</div>
                        `,
                        iconSize: [40, 40],
                        iconAnchor: [20, 20]
                    });

                    const marker = L.marker([loc.lat, loc.lng], { icon: customIcon }).addTo(this.map);

                    marker.bindPopup(`
                        <div style="min-width: 200px;">
                            <h3 style="font-weight: bold; font-size: 18px; margin-bottom: 8px;">
                                ${loc.icon} ${loc.name}
                            </h3>
                            <p style="color: #666; margin-bottom: 8px; font-size: 14px;">${loc.description}</p>
                            <p style="color: ${colorHex}; font-weight: bold;">
                                â° ${loc.time}
                            </p>
                        </div>
                    `);

                    this.markers.push(marker);
                    latlngs.push([loc.lat, loc.lng]);
                });

                // Draw route line
                this.polyline = L.polyline(latlngs, {
                    color: colorHex,
                    weight: 4,
                    opacity: 0.7,
                    dashArray: '10, 10',
                    lineJoin: 'round'
                }).addTo(this.map);

                // Add arrow decorators
                const arrowDecorator = L.polylineDecorator(this.polyline, {
                    patterns: [
                        {
                            offset: 50,
                            repeat: 100,
                            symbol: L.Symbol.arrowHead({
                                pixelSize: 12,
                                polygon: false,
                                pathOptions: {
                                    stroke: true,
                                    weight: 3,
                                    color: colorHex
                                }
                            })
                        }
                    ]
                });
                arrowDecorator.addTo(this.map);

                // Fit bounds
                const bounds = L.latLngBounds(latlngs);
                this.map.fitBounds(bounds, { padding: [50, 50] });
            }
        }

        // Main App
        class TripApp {
            constructor() {
                this.currentRoute = 'route2';
                this.path3D = null;
                this.tripMap = null;
            }

            async init() {
                console.log('Initializing app...');

                // Wait a bit for DOM to be fully ready
                await new Promise(resolve => setTimeout(resolve, 100));

                // Initialize 3D
                this.path3D = new Path3D('canvas3d');
                if (this.path3D.initialize()) {
                    console.log('3D initialized');
                } else {
                    console.error('Failed to initialize 3D');
                }

                // Initialize Map
                const route = ROUTES[this.currentRoute];
                const center = route.locations[0];
                this.tripMap = new TripMap();
                if (this.tripMap.initialize('map', center)) {
                    console.log('Map initialized');
                } else {
                    console.error('Failed to initialize map');
                }

                // Show initial route
                this.showRoute(this.currentRoute);
            }

            showRoute(routeKey) {
                console.log('Showing route:', routeKey);
                this.currentRoute = routeKey;
                const route = ROUTES[routeKey];

                // Update 3D
                if (this.path3D) {
                    this.path3D.createPath(route.locations, route.color);
                    this.path3D.start();
                }

                // Update Map
                if (this.tripMap) {
                    this.tripMap.showRoute(route.locations, route.color);
                }

                this.render();
            }

            render() {
                const route = ROUTES[this.currentRoute];

                const html = `
                    <div class="min-h-screen p-4 md:p-8">
                        <div class="max-w-7xl mx-auto">
                            <!-- Header -->
                            <div class="text-center mb-8">
                                <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-2">
                                    ğŸ—ºï¸ å°ç£å˜‰ç¾©å°å—æ—…éŠè·¯ç·š
                                </h1>
                                <p class="text-gray-600 text-lg">æ¢ç´¢å—å°ç£çš„ç¾é£Ÿèˆ‡æ–‡åŒ–ä¹‹æ—…</p>
                            </div>

                            <!-- Route Selector -->
                            <div class="flex gap-4 justify-center mb-8 flex-wrap">
                                <button
                                    onclick="app.showRoute('route2')"
                                    class="px-6 py-3 rounded-xl font-bold transition-all ${
                                        this.currentRoute === 'route2'
                                        ? 'bg-green-500 text-white shadow-lg scale-105'
                                        : 'bg-white text-gray-700 hover:bg-gray-100'
                                    }">
                                    ğŸŒ¿ è·¯ç·šäºŒï¼šå˜‰ç¾©æ–‡åŒ–ä¹‹æ—…
                                </button>
                                <button
                                    onclick="app.showRoute('day1')"
                                    class="px-6 py-3 rounded-xl font-bold transition-all ${
                                        this.currentRoute === 'day1'
                                        ? 'bg-amber-500 text-white shadow-lg scale-105'
                                        : 'bg-white text-gray-700 hover:bg-gray-100'
                                    }">
                                    ğŸœ ç¬¬ä¸€å¤©ï¼šå°å—ç¾é£Ÿä¹‹æ—…
                                </button>
                            </div>

                            <!-- 3D Visualization -->
                            <div class="bg-white rounded-2xl shadow-2xl p-6 mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    <span>ğŸ¨</span>
                                    <span>3D è·¯ç·šè¦–è¦ºåŒ–</span>
                                    <span class="text-sm font-normal text-gray-500">(è‡ªå‹•æ—‹è½‰å±•ç¤º)</span>
                                </h2>
                                <div id="canvas3d"></div>
                                <p class="text-center text-gray-500 text-sm mt-4">
                                    ğŸ’¡ å½©è‰²çƒé«”ä»£è¡¨å„å€‹æ™¯é»ï¼Œæœƒè‡ªå‹•æ—‹è½‰ä¸¦å‘¼å¸é–ƒçˆ
                                </p>
                            </div>

                            <!-- Leaflet Map -->
                            <div class="bg-white rounded-2xl shadow-2xl p-6 mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    <span>ğŸ“</span>
                                    <span>äº’å‹•å¼åœ°åœ–è·¯ç·š</span>
                                    <span class="text-sm font-normal text-gray-500">(é»æ“Šæ¨™è¨˜æŸ¥çœ‹è©³æƒ…)</span>
                                </h2>
                                <div id="map"></div>
                                <p class="text-center text-gray-500 text-sm mt-4">
                                    ğŸ—ºï¸ ä½¿ç”¨ OpenStreetMapï¼Œé»æ“Šæ•¸å­—æ¨™è¨˜æŸ¥çœ‹æ™¯é»è³‡è¨Š
                                </p>
                            </div>

                            <!-- Location Cards -->
                            <div class="bg-white rounded-2xl shadow-2xl p-6 mb-8">
                                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                                    ğŸ“‹ ${route.name} - è©³ç´°è¡Œç¨‹
                                </h2>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    ${route.locations.map((loc, index) => `
                                        <div class="location-card bg-gradient-to-br from-white to-gray-50 rounded-xl p-6 border-2 border-gray-200 shadow-lg">
                                            <div class="flex items-start gap-4">
                                                <div class="text-5xl flex-shrink-0">${loc.icon}</div>
                                                <div class="flex-1 min-w-0">
                                                    <div class="flex items-center gap-2 mb-2">
                                                        <span class="bg-${this.currentRoute === 'route2' ? 'green' : 'amber'}-500 text-white font-bold px-3 py-1 rounded-full text-sm flex-shrink-0">
                                                            ${index + 1}
                                                        </span>
                                                        <h3 class="text-xl font-bold text-gray-800 truncate">
                                                            ${loc.name}
                                                        </h3>
                                                    </div>
                                                    <p class="text-gray-600 text-sm mb-3 line-clamp-2">
                                                        ${loc.description}
                                                    </p>
                                                    <div class="flex items-center text-blue-600 font-semibold text-sm mb-2">
                                                        <span class="mr-2">â°</span>
                                                        <span>${loc.time}</span>
                                                    </div>
                                                    <div class="text-xs text-gray-400">
                                                        ğŸ“ ${loc.lat.toFixed(4)}, ${loc.lng.toFixed(4)}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <!-- Info Cards -->
                            <div class="grid md:grid-cols-2 gap-6 mb-8">
                                <div class="bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl shadow-2xl p-6 text-white">
                                    <h3 class="text-2xl font-bold mb-4">ğŸ’¡ ä½¿ç”¨æç¤º</h3>
                                    <ul class="space-y-2">
                                        <li>ğŸ¨ 3D è¦–è¦ºåŒ–æœƒè‡ªå‹•æ—‹è½‰å±•ç¤ºæ‰€æœ‰æ™¯é»</li>
                                        <li>ğŸ—ºï¸ é»æ“Šåœ°åœ–ä¸Šçš„æ•¸å­—æ¨™è¨˜æŸ¥çœ‹æ™¯é»è©³æƒ…</li>
                                        <li>ğŸ”„ é»æ“Šä¸Šæ–¹æŒ‰éˆ•åˆ‡æ›ä¸åŒæ—…éŠè·¯ç·š</li>
                                        <li>ğŸ“± æ”¯æ´æ‰‹æ©Ÿã€å¹³æ¿ã€é›»è…¦å„ç¨®è£ç½®</li>
                                    </ul>
                                </div>
                                <div class="bg-gradient-to-br from-green-500 to-teal-600 rounded-2xl shadow-2xl p-6 text-white">
                                    <h3 class="text-2xl font-bold mb-4">ğŸ¯ è·¯ç·šç‰¹è‰²</h3>
                                    <ul class="space-y-2">
                                        ${this.currentRoute === 'route2' ? `
                                            <li>ğŸ›ï¸ æ•…å®®å—é™¢æ¬£è³äºæ´²è—è¡“</li>
                                            <li>âš“ å¸ƒè¢‹æ¼æ¸¯å“åšæ–°é®®æµ·ç”¢</li>
                                            <li>ğŸ‘  é«˜è·Ÿé‹æ•™å ‚æµªæ¼«æ‰“å¡</li>
                                            <li>ğŸ•¯ï¸ æ–°æ¸¯é¦™è—æ–‡åŒ–é«”é©—</li>
                                        ` : `
                                            <li>â›©ï¸ å—é¯¤é¯“ä»£å¤©å®®åƒæ‹œç¥ˆç¦</li>
                                            <li>ğŸ¦ é˜¿æ¨‚æ´»æµ·é®®å¤§å¿«æœµé ¤</li>
                                            <li>ğŸ¨ é£¯åº—ä¼‘æ¯è£œå……é«”åŠ›</li>
                                            <li>ğŸŒƒ åœ‹è¯è¡—å¤œå¸‚ç¾é£Ÿå¤©å ‚</li>
                                        `}
                                    </ul>
                                </div>
                            </div>

                            <!-- Footer -->
                            <div class="text-center text-gray-500 text-sm">
                                <p>Â© 2024 å°ç£æ—…éŠè·¯ç·šè¦åŠƒ | Made with â¤ï¸ using Three.js & Leaflet.js</p>
                                <p class="mt-2">ğŸ—ºï¸ åœ°åœ–è³‡æ–™ä¾†æºï¼šOpenStreetMap contributors</p>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('root').innerHTML = html;
            }
        }

        // Initialize app when DOM is ready
        let app;
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                app = new TripApp();
                app.render();
                app.init();
                window.app = app;
            });
        } else {
            app = new TripApp();
            app.render();
            app.init();
            window.app = app;
        }
    </script>

    <!-- Leaflet Polyline Decorator for arrows -->
    <script src="https://unpkg.com/leaflet-polylinedecorator@1.6.0/dist/leaflet.polylineDecorator.js"></script>
</body>
</html>
